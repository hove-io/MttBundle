<?php

namespace CanalTP\MttBundle\Entity;

use Doctrine\ORM\EntityRepository;

/**
 * SeasonRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class SeasonRepository extends EntityRepository
{
//    public function getSeasonByNetworkIdAndSeasonId($networkId, $seasonId)
//    {
//        $season = null;
//        if ($seasonId) {
//            $season = $this->find($seasonId);
//        }
//        if (!$season) {
//            $networkRepository = $this->getEntityManager()->getRepository('CanalTPMttBundle:Network');
//            $season = new Season();
//
//            $season->setPerimeter($networkRepository->findOneByExternalNetworkId($perimeterId));
//        }
//
//        return ($season);
//    }

    public function getByPerimeter($perimeter)
    {
        $query = $this->getEntityManager()->createQueryBuilder()
            ->select('s')
            ->from('CanalTPMttBundle:Season', 's')
            ->where('s.perimeter = :perimeter')
            ->setParameter('perimeter', $perimeter)
            ->getQuery();

        return $query->getResult();
    }

    // used by webservice
    public function findSeasonForDateTime($dateTime)
    {
        $query = $this->getEntityManager()->createQueryBuilder()
                    ->select("s.id")
                    ->from("CanalTPMttBundle:Season", "s")
                    ->where("s.published = TRUE")
                    ->andWhere("s.startDate <= '".$dateTime->format("Y-m-d H:i:s")."'")
                    ->andWhere("s.endDate >= '".$dateTime->format("Y-m-d H:i:s")."'")
                    ->getQuery();

        return $query->getResult();
    }
}
