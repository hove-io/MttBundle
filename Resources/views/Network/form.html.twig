{% extends "::modal.html.twig" %}

{% form_theme form 'CanalTPMttBundle:Form:fields.html.twig' %}

{% block open_form %}
    {{ form_start(form) }}
{% endblock %}

{% block modal_title %}
    {{'network.create'|trans({}, 'default')}}
{% endblock %}


{% block modal_body %}
    {{ form_errors(form) }}

    {{ form_row(form.token) }}

    {{ form_row(form.external_coverage_id) }}

    {{ form_label(form.external_id, null, { 'label_attr': {'style': 'display:none;'} }) }}
    {{ form_widget(form.external_id, { 'attr': {'style': 'display:none;'} }) }}
{% endblock %}

{% block modal_actions %}
    <button type="submit" class="btn btn-success">
        <span class="glyphicon glyphicon-pencil"></span> {{'global.save'|trans}}
    </button>
    {{ form_end(form) }}
    <script type="text/javascript">
    require(['navitia'], function(Navitia, utils){
        var nav_api = new Navitia();

        $('#mtt_network_external_coverage_id').change(function(){
            var token = $('#mtt_network_token');

            if (token.val() != '') {
                var $networkSelect = $('#mtt_network_external_id').empty();

                nav_api.getCoverageNetworks(
                    {
                        'externalCoverageId': $(this).val(),
                        'token': token.val()
                    },
                    function(networks){
                        var network = null;

                        for (key in networks) {
                            $networkSelect.append('<option value="' + key + '">' + networks[key] + '</option>');
                        }
                        $networkSelect.show().siblings('label').show();
                    },
                    function(){
                        $networkSelect.hide().siblings('label').hide();
                    }
                );
            }
        });
    });
    </script>
{% endblock %}
