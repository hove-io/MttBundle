{% extends "CanalTPMttBundle::generic_list.html.twig" %}
{% set navigationMode = 'lines' %}

{% import "CanalTPMttBundle::macros.html.twig" as rendering %}

{% block breadcrumb %}
    <li>{{ 'menu.edit_timetables'|trans }}</li>
{% endblock %}

{% block main_content %}
    <h1>{{ 'line_timetable.title.select_stops'|trans({}, 'default') }}</h1>
    <h4>{{ rendering.lineNumber(externalLineData) }} {{ 'line_timetable.label.way'|trans({}, 'default') }} : </h4>
    <div class="row top-menu">
        <div class="col-md-6">
            <select id="select-route" class="form-control">
                {% set selectedRouteName = none %}
                {% for route in routes %}
                    {% if route.id == externalRouteId %}
                        {% set selected = "selected='selected'" %}
                        {% set selectedRouteName = route.name %}
                    {% else %}
                        {% set selected = none %}
                    {% endif %}
                    <option
                        {{ selected }}
                        data-external-route-id="{{ route.id }}"
                        data-external-network-id="{{ externalNetworkId }}"
                        data-season-id="{{ currentSeason.id }}"
                        data-line-timetable-id="{{ lineTimetable.id }}"
                    >
                        {{ route.name }}
                    </option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-6">
            <button class="save-selection btn btn-primary pull-right">
                <span class="glyphicon glyphicon-floppy-disk"></span> {{ 'global.save'|trans }}
            </button>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <h4>
                <div class="row">
                    <div class="col-md-6">
                        {{ 'line_timetable.label.available_stops'|trans({}, 'default') }}
                    </div>
                    <div class="col-md-6">
                        <button id="select-all" class="btn btn-default btn-xs pull-right">
                            {{ 'line_timetable.action.select_all_stops'|trans({}, 'default') }}
                            <span class="glyphicon glyphicon-arrow-right"></span>
                        </button>
                    </div>
                </div>
            </h4>
            <hr class="no-border black"/>
            <ul id="available-stops" class="list-group">
                {% for stopPoint in availableStopPoints %}
                <li
                    class="list-group-item{% if stopPoint.selected %} active{% endif %}"
                    data-external-stop-point-id="{{ stopPoint.id }}"
                    data-external-route-id="{{ externalRouteId }}"
                >
                    <span class="stop-name">{{ stopPoint.name }}</span>
                    <a href="#" class="pull-right plus-btn add-stop-point"></a>
                    <a href="#" class="pull-right minus-btn remove-stop-point"></a>
                    <div>{{ rendering.lineNumber(externalLineData, false) }} - {{ selectedRouteName }}</div>
                </li>
                {% endfor %}
            </ul>
        </div>
        <div class="col-md-6">
            <h4>
                <div class="row">
                    <div class="col-md-6">
                        {{ 'line_timetable.label.selected_stops'|trans({}, 'default') }}
                    </div>
                    <div class="col-md-6">
                        <button id="remove-all" class="btn btn-default btn-xs pull-right">
                            {{ 'line_timetable.action.remove_all_stops'|trans({}, 'default') }}
                            <span class="glyphicon glyphicon-remove"></span>
                        </button>
                    </div>
                </div>
            </h4>
            <hr class="no-border black"/>
            <ul id="selected-stops" class="list-group sortable area-list ui-sortable{% if selectedStopPoints is empty %} empty-list{% endif %}">
                {% for selectedStopPoint in selectedStopPoints %}
                <li
                    class="list-group-item"
                    data-external-stop-point-id="{{ selectedStopPoint.externalStopPointId }}"
                    data-external-route-id="{{ selectedStopPoint.externalRouteId }}"
                >
                    <span class="stop-name">{{ availableStopPoints[selectedStopPoint.externalStopPointId].name }}</span>
                        <a href="#" class="pull-right plus-btn add-stop-point"></a>
                        <a href="#" class="pull-right minus-btn remove-stop-point"></a>
                        <div>{{ rendering.lineNumber(externalLineData, false) }} - {{ selectedRouteName }}</div>
                     </li>
                {% else %}
                    <span class="help-block">
                        {{ 'line_timetable.message.no_stops'|trans({}, 'default') }}
                    </span>
                {% endfor %}
            </ul>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <button class="save-selection btn btn-primary pull-right">
                <span class="glyphicon glyphicon-floppy-disk"></span> {{ 'global.save'|trans }}
            </button>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    <script type="text/javascript">
        require(['mtt/line_timetable/select_stops']);
    </script>
{% endblock %}
