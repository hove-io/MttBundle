{% import "CanalTPMttBundle:Layouts:macros.html.twig" as macros %}

{% extends "CanalTPMttBundle:Layouts:base_layout.html.twig" %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" media="all" href="{{ asset('bundles/canaltpmtt/css/stop.css') }}?{{ assets_version }}" />
{% endblock %}

{% block timetable_content %}
    <div id="layout-1-wrapper" class="{% block additionnal_wrapper_class %}{% endblock %}">
        <div class="layout-container">
            <div id="header" class="clearfix">
                <div id="direction-title-wrapper" data-auto-filled="1">
                    {% if stopTimetable.title is defined %}
                        {{ 'global.direction'|trans }} {{ stopTimetable.title }}
                    {% endif %}
                </div>
                <div id="stop-point-title-wrapper" data-auto-filled="1">
                    <div class="bold">{{'stop_point.label'|trans({}, 'default')}}:</div> {{ stopPoint.title }}
                </div>
            </div>
            <div id="map-wrapper" class="clearfix">
                <div id="small-left-blocks">
                    {{ macros.stop_point_pois('text_block_3', stopPoint, 'small-block') }}
                    {{ macros.season_validity('text_block_1', currentSeason, 'small-block') }}
                    {{ macros.stop_point_code('text_block_4', stopPoint, 'small-block') }}
                    {{ macros.text('text_block_2', stopTimetable.BlockByDomId('text_block_2'), 'small-block') }}
                </div>
                {{ macros.img('line_map_block', stopTimetable.BlockByDomId('line_map_block'), 'line_map_img') }}

            </div>
            {% block stop_timetables_wrapper %}
                <div id="stop-timetables-wrapper" class="clearfix">
                    {% for i in 1..2 %}
                        {% set id = 'timegrid_block_' ~ i %}
                        {% set block = stopTimetable.BlockByDomId(id) %}
                        <div
                            {% if editable %}
                            title="{{ 'help.edit_block'|trans }}"
                            {% endif %}
                            id="{{ id }}"
                            class="timegrid-container block"
                            data-type="calendar"
                            data-icon="calendar"
                            data-id="{{ block.id|default(-1) }}"
                            data-rank={{ i }}
                        >
                            <div class="timegrid-header">
                                {% if block %}{{ block.title }}{% endif %}
                            </div>
                            <div class="timegrid-body relative" data-validate-size="1">
                                {% set calendar = attribute(calendars, block.content) %}
                                <!-- Frequencies -->
                                {% if (calendar.schedules.additional_informations is not empty) %}
                                    <div class="external-additional-informations">{{ calendar.schedules.additional_informations }}</div>
                                    <table class="empty-timegrid">
                                {% else %}
                                    <table>
                                {% endif %}
                                    {% set hours_range = layout|calendarRange %}
                                    {{ macros.hours_thead(hours_range)}}
                                    {% if block.frequencies is not empty and (calendar.schedules.additional_informations is empty) %}
                                        {%
                                            include "CanalTPMttBundle:Layouts:display.html.twig"
                                            with { 'frequencies' : block.frequencies, 'hours_range' : hours_range }
                                        %}
                                    {% endif %}
                                    {{ macros.stop_calendar(id, externalNetworkId, stopTimetable, layout, block, calendar, notes, hours_range, null, notesType) }}
                                </table>

                                {# position is specific to this layout ie i==1... #}
                                {% if i == 1 and notes|length > 0 %}
                                    <div class="stop-timetable-notes">
                                    {% for note in notes %}
                                        {% if note.color is not null %}
                                            <div><span class="bold color-reference" style="background-color: {{ note.color }}">&nbsp;_&nbsp;</span>: {{ note.value|raw }}</div>
                                        {% endif %}
                                    {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% endblock %}
        </div>
    </div>
{% endblock %}

{% block scripts %}
    {%
        include "CanalTPMttBundle:Layouts:common.html.twig"
        with {
            'editable'          : editable,
            'externalNetworkId' : externalNetworkId,
            'timetableId'       : stopTimetable.id,
            'type'              : 'stop',
            'selector'          : '#layout-1-wrapper'
        }
    %}
{% endblock %}
